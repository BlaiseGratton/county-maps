"use strict";!function(){String.prototype.countyMapsToLowerNoSpaces=function(){return this.replace(" ","_").toLowerCase()};var e=angular.module("countyMap",["datamaps"]);e.controller("mapController",["$scope",function(e){e.tennessee={scope:"tn_counties",geographyConfig:{dataUrl:function(){var t="/bower_components/tn-datamaps/topo_tn_counties.json";return e.options&&e.options.url&&(t=e.options.url),t}(),highlightOnHover:!1},options:{staticGeoData:!0},fills:{selected:"#a55",defaultFill:"#9cf"},data:{},setProjection:function(t){var o=t.childNodes[0];o.attributes.width.value="849",o.attributes.height.value="238",o.setAttribute("viewBox","377 44 800 190"),e.options&&e.options.classes&&e.options.classes.forEach(function(e){o.classList.add(e)});var n=d3.geo.mercator().center([-86.7833,36.1667]).scale(5e3).rotate([8,0]).translate([0,100]),s=d3.geo.path().projection(n);return{path:s,projection:n}}},e.options&&e.options.fills&&(e.tennessee.fills.selected=e.options.fills.selected||"#a55",e.tennessee.fills.defaultFill=e.options.fills.defaultFill||"#99ccff");var t=e.$watch("selectedCounties",function(t){e.colorCounties(t)},!0);e.colorCounties=e.options&&e.options.multiple?function(t){if(t){var o=_.map(t,function(t){return t[e.key].countyMapsToLowerNoSpaces()});e.tennessee.data=_.mapObject(e.tennessee.data,function(e){return o.indexOf(e)<0?{fillKey:"defaultFill"}:void 0}),o.forEach(function(t){e.tennessee.data[t]={fillKey:"selected"}})}}:function(t){if(e.tennessee.data=_.mapObject(e.tennessee.data,function(){return{fillKey:"defaultFill"}}),t&&Object.keys(t).length){var o=t[e.key].countyMapsToLowerNoSpaces();0!==e.selectedCounties.length&&(e.tennessee.data[o]={fillKey:"selected"})}},e.$on("$destroy",t),e.toggleCounty=e.options&&e.options.multiple?function(t){e.selectedCounties=e.selectedCounties?e.selectedCounties:[];var o=_.filter(e.selectedCounties,function(o){return o[e.key].countyMapsToLowerNoSpaces()===t.id.countyMapsToLowerNoSpaces()}),n=_.find(e.counties,function(o){return o[e.key].countyMapsToLowerNoSpaces()===t.id.countyMapsToLowerNoSpaces()}),s=e.selectedCounties.indexOf(n);o.length?e.selectedCounties.splice(s,1):e.selectedCounties.push(n),e.$apply(),e.options.onAfterCountySelect&&e.options.onAfterCountySelect(n,t)}:function(t){e.selectedCounties=e.selectedCounties?e.selectedCounties:{};var o=_.find(e.counties,function(o){return o[e.key].countyMapsToLowerNoSpaces()===t.id.countyMapsToLowerNoSpaces()});e.selectedCounties=e.selectedCounties===o?null:o,e.$apply(),e.options&&e.options.onAfterCountySelect&&e.options.onAfterCountySelect(o,t)}}]),e.directive("countyMap",function(){return{restrict:"EA",controller:"mapController",template:'<datamap map="tennessee"on-click="toggleCounty"></datamap>',scope:{selectedCounties:"=",key:"@",counties:"=",options:"="}}})}();
